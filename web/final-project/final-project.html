<!DOCTYPE html>
<html>
<head>
	<title>Casey Spain's Assign09</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="final-project.css"/>
    <script type="text/javascript">
    function search() {
        // Get the value from the search box
        var searchString = document.getElementById('txtSearch').value;
        console.log('Searching for: ' + searchString);
        var url = 'https://www.omdbapi.com/?i=tt3896198&apikey=5797b0b&s=' + encodeURIComponent(searchString);
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
	    	if (this.readyState == 4 && this.status == 200) {
                var data = this.response;
                parsed = JSON.parse(data);
                // console.log(data);
                console.log(JSON.parse(data));
                updateResultList(parsed);
            }
	  	};
        xhttp.open("GET", url, true);
        xhttp.send();
    }

    function updateResultList(data) {
        if (data.Search && data.Search.length > 0) {
            const resultList = document.getElementById('divResults');
            resultList.innerHTML = '';
            // you could use a forEach here as well...it would change the following line like this:
            data.Search.forEach(function(item){
                const title = item.Title;
                // console.log('Adding: ' + title);
                // const content = `<li><p>${title}</p></li>`;
                // resultList.innerHTML += content;
                console.log(item);
                if(item.Poster != 'N/A'){
                    const poster = item.Poster;
                    const content2 = `<img onclick='searchItem("${title}");' class='thumbnail moveUp' src='${poster}' alt='${title}'/>`;
                    resultList.innerHTML += content2;
                }
            })
        }
    }

    function searchItem(name) {
        console.log(name);
        var url = 'https://www.omdbapi.com/?i=tt3896198&apikey=5797b0b&t=' + name;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
	    	if (this.readyState == 4 && this.status == 200) {
                var data = this.response;
                parsed = JSON.parse(data);
                // console.log(data);
                console.log(JSON.parse(data));
                singleItem(parsed);
            }
	  	};
        xhttp.open("GET", url, true);
        xhttp.send();
    }

    function singleItem(data) {
        console.log("Single Item: ");
        console.log(data);
        const resultList = document.getElementById('divResults');
        resultList.innerHTML = '';
        poster = data.Poster;
        console.log(poster);
        title = data.Title;
        console.log(title);
        year = data.Year;
        console.log(year);
        actors = data.Actors;
        director = data.Director;
        plot = data.Plot;
        rating = data.Rating;
        runtime = data.Runtime;
        imdbRate = data.imdbRating;
        content = `<img class='selected' src='${poster}' alt='${title}'/><br>
                    <h3>${title}</h3>
                    <div class='details'><p><strong>Year:</strong> ${year}</p>
                    <p><strong>Actors:</strong> ${actors}</p>
                    <p><strong>Director:</strong> ${director}</p>
                    <p><strong>Plot:</strong> ${plot}</p>
                    <p><strong>Rating:</strong> ${rating}</p>
                    <p><strong>Runtime:</strong> ${runtime}</p>
                    <p><strong>imdb Rating:</strong> ${imdbRate}</p>
                    <button class='button1' onclick='addFavorite(${title});'>Add To Collection</button></div>`;
        resultList.innerHTML = content;
    }

    function addFavorite(name) {
        console.log(name);
        var url = 'https://www.omdbapi.com/?i=tt3896198&apikey=5797b0b&t=' + name;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
	    	if (this.readyState == 4 && this.status == 200) {
                var data = this.response;
                parsed = JSON.parse(data);
                console.log("Adding: " + parsed.Title);
                localStorage.setItem(favorite + localStorage.length, parsed.Title);
                alert("Movie Added to Collection");
            }
	  	};
        xhttp.open("GET", url, true);
        xhttp.send();
    }
    </script>
</head>

<body>
	<script>
    </script>
<div class="topnav">
    <a class="active" href="#home">Home</a>
    <a href="collection.html">Collection</a>
</div>
<div class="header">
    <br>
    <br>
    <h1>Movie Search</h1>
    <br><br>
</div>

<div class="divResults">
<p>Please enter a movie title to search:</p>
<input type="text" id="txtSearch">
<button class="button1" onclick="search();">Search</button>
<h3>Results</h3>
</div>

<div class="divResults" id="divResults">
</div>

</body>
</html>